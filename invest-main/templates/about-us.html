{% extends "base.html" %}

{% block content %}

<header class="header-2">
  <div class="page-header min-vh-100 relative" style="background-image: url('{{ url_for('static', filename='assets/img/about-us-2.jpg') }}')">
    <span class="mask bg-gradient-info opacity-8"></span>
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-8 text-center mx-auto my-auto">
          <h1 class="text-white" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.7);">Who we are</h1>

          <p class="lead mb-0 text-white opacity-8 about-us-text" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.7);">
            The Central Prairie Development Alliance (CPDA) was born from a shared understanding: no single community has the capacity to tackle economic and social development alone. We function as a region—and we must grow and thrive as one.
          </p>
          <br />

          <p class="lead mb-0 text-white opacity-8 about-us-text" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.7);">
            The initial conversation began with representatives from Suncrest College, the City of Yorkton, the Yorkton and District Chamber of Commerce, and the Yorkton Tribal Council. Together, they explored how a broader, more inclusive regional approach—one that brings together First Nations, cities, towns, villages, and rural municipalities—could strengthen economic and social development across the area.
          </p>
          <br />

          <p class="lead mb-0 text-white opacity-8 about-us-text" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.7);">
            While many of the founding organizations were based in Yorkton, it was clear from the outset that this could not be a Yorkton-only initiative. The group agreed to invite communities within Yorkton’s broader trading area to a regional meeting to formally launch the CPDA.
          </p>
          <br />

          <p class="lead mb-0 text-white opacity-8 about-us-text" style="text-shadow: 2px 2px 8px rgba(0,0,0,0.7);">
            That first meeting took place on a frigid December morning in Canora in 2025, with representatives from 11 villages, towns, and organizations in attendance. Since then, the CPDA has met regularly every two months. In June, the Alliance took a major step forward by forming a series of sub-committees to focus on key priority areas.
          </p>
        </div>
      </div>
    </div>
  </div>
</header>

<section class="py-5">
  <div class="container">
    <div class="row justify-content-center text-center mb-4">
      <div class="col-lg-8">
        <h2 class="text-gradient text-primary">Why CPDA Matters</h2>
        <p class="lead">Our work strengthens regional collaboration and enhances quality of life through:</p>
        <div class="row text-start justify-content-center">
          <div class="col-md-8">
            <ul class="list-unstyled">
              <li class="mb-3">&#9632; <strong>Unified Regional Advocacy</strong> for economic growth and more</li>
              <li class="mb-3">&#9632; <strong>Regional Housing & Workforce Planning</strong></li>
              <li class="mb-3">&#9632; <strong>Access to Services</strong> (Childcare, Health, Legal)</li>
              <li class="mb-3">&#9632; <strong>Regional Transportation</strong></li>
              <li class="mb-3">&#9632; <strong>Quality of Life & Recreation</strong></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="py-5 bg-gradient-primary position-relative text-white">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-10 text-center">
        <p class="mb-1 fs-3 fst-italic">“We are turning shared challenges into shared opportunities — shaping the future of our region, together.”</p>
        <br />
        <p class="fs-4"><strong>Sharon Rurak, Suncrest College</strong></p>
      </div>
    </div>
  </div>
</section>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
  #cpda-map {
    height: 500px;
    width: 100%;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
  }
  .cpda-town-btn {
    transition: transform 0.2s;
    border: 1px solid #dee2e6;
  }
  .cpda-town-btn:hover {
    transform: translateY(-2px);
    background-color: #f8f9fa;
  }
</style>

<section class="py-5">
  <div class="container">
    <div class="row justify-content-center text-center mb-4">
      <div class="col-lg-8">
        <h2 class="text-gradient text-primary">Who are the communities in CPDA?</h2>
        <p class="lead">Click on each pin to visit the homepage of a CPDA member community.</p>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div id="cpda-map"></div>
      </div>
    </div>

    {% set towns_list = [
      {'name': 'Langenburg', 'url': 'https://langenburg.ca', 'lat': 51.8501, 'lng': -101.7002},
      {'name': 'Esterhazy', 'url': 'https://townofesterhazy.ca', 'lat': 50.6501, 'lng': -102.0667},
      {'name': 'Stockholm', 'url': 'https://stockholmsask.com', 'lat': 50.8833, 'lng': -102.2833},
      {'name': 'Grayson', 'url': 'https://villageofgrayson.com/', 'lat': 50.6333, 'lng': -102.6833},
      {'name': 'Melville', 'url': 'https://melville.ca', 'lat': 50.9333, 'lng': -102.8000},
      {'name': 'RM of Saltcoats', 'url': 'https://rmsaltcoats.ca/', 'lat': 51.6333, 'lng': -102.3333},
      {'name': 'Yorkton', 'url': 'https://www.yorkton.ca/en/index.aspx', 'lat': 51.2139, 'lng': -102.4628},
      {'name': 'Springside', 'url': 'https://townofspringside.ca/', 'lat': 51.4667, 'lng': -102.5667},
      {'name': 'Sheho', 'url': './', 'lat': 51.4833, 'lng': -103.0167},
      {'name': 'Sturgis', 'url': 'https://townofsturgis.ca/', 'lat': 51.9500, 'lng': -102.5333},
      {'name': 'Hyas', 'url': 'https://www.villageofhyas.com/', 'lat': 51.9833, 'lng': -102.2833},
      {'name': 'Cote 64', 'url': './', 'lat': 51.9000, 'lng': -102.4000},
      {'name': 'Ituna', 'url': 'https://ituna.ca/', 'lat': 51.6333, 'lng': -103.3833},
      {'name': 'Ituna Bon Accord no. 256', 'url': 'https://www.municipality-canada.com/en/rural-municipality-ituna-bon-accord.html', 'lat': 51.6500, 'lng': -103.4000},
      {'name': 'Foam Lake', 'url': 'https://foamlake.com', 'lat': 51.6500, 'lng': -103.5333},
      {'name': 'Buchanan', 'url': 'https://www.saskatchewan.ca/government/municipal-administration/municipal-directory?s=%7Bf74a076b-cd2b-4068-9baa-95dc4a4c0d94%7D', 'lat': 51.7000, 'lng': -102.8833}
    ] %}

    <div class="row justify-content-center mt-5">
      <div class="col-lg-10 text-center">
        <h5 class="mb-4" style="color:#23254a; font-weight:700; font-size:2rem;">CPDA Member Communities</h5>
        <div class="row row-cols-2 row-cols-sm-3 row-cols-md-4 g-3 justify-content-center">
          {% for town in towns_list|sort(attribute='name') %}
            <div class="col d-flex justify-content-center">
              <a href="{{ town.url }}" target="_blank" class="btn cpda-town-btn mb-2 w-100 shadow-sm">
                <i class="fas fa-map-marker-alt me-2"></i>{{ town.name }}
              </a>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  // Initialize the Map
  var map = L.map('cpda-map').setView([51.4, -102.6], 8);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Map data © <a href="https://openstreetmap.org">OpenStreetMap</a> contributors'
  }).addTo(map);

  // List of communities that have paid their fees
  var paidMembers = new Set([
    "Yorkton",
    "Ituna",
    "Ituna Bon Accord no. 256"
  ]);

  // Icons Definition
  var greenIcon = new L.Icon({
    iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-green.png",
    shadowUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });

  var redIcon = new L.Icon({
    iconUrl: "https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png",
    shadowUrl: "https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png",
    iconSize: [25, 41],
    iconAnchor: [12, 41],
    popupAnchor: [1, -34],
    shadowSize: [41, 41]
  });

  // Data passed from Jinja or defined here for JS
  var townsData = {{ towns_list | tojson }};

  townsData.forEach(function(town) {
    if (town.lat && town.lng) {
      // Logic to decide pin color
      var iconToUse = paidMembers.has(town.name) ? greenIcon : redIcon;

      var marker = L.marker([town.lat, town.lng], { icon: iconToUse }).addTo(map);

      // Popup Content
      var popupContent = `
        <div style="text-align: center;">
          <a href="${town.url}" target="_blank" style="color:#23254a; font-weight:700; text-decoration:none;">
            <i class="fas fa-map-marker-alt"></i> ${town.name}
          </a>
          <br/>
          <small>Click to visit website</small>
        </div>`;

      marker.bindPopup(popupContent);
      marker.bindTooltip(town.name, { permanent: false, direction: 'top' });

      // Action on Click
      marker.on('click', function() {
        if(town.url !== './') {
          window.open(town.url, '_blank');
        }
      });
    }
  });
</script>

{% endblock %}